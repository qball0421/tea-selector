<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å°æ–‡çš„èŒ¶ï½œé¸èŒ¶å™¨</title>
  <style>
    :root{
      --bg:#faf7f2;
      --card:#ffffff;
      --ink:#1f2937;
      --muted:#6b7280;
      --line:#e5e7eb;
      --accent:#2f4f3a;
      --soft:#f4efe6;
      --shadow: 0 8px 30px rgba(0,0,0,.06);
      --r:16px;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font-family: system-ui,-apple-system,"Noto Sans TC","PingFang TC","Microsoft JhengHei",sans-serif;line-height:1.55}
    a{color:var(--accent);text-decoration:none}
    .wrap{max-width:980px;margin:0 auto;padding:18px}
    .hero{background:linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.6));border:1px solid var(--line);border-radius:24px;box-shadow:var(--shadow);overflow:hidden}
    .heroImg{height:180px;background-size:cover;background-position:center}
    .heroBody{padding:18px 18px 8px}
    h1{margin:0 0 8px;font-size:22px;letter-spacing:.5px}
    .lead{margin:0;color:var(--muted)}
    .notice{margin:12px 0 0;padding:10px 12px;background:var(--soft);border:1px solid var(--line);border-radius:12px;color:#374151;font-size:14px}
    .grid{display:grid;grid-template-columns:1fr;gap:14px;margin-top:14px}
    @media (min-width:900px){ .grid{grid-template-columns: 1.1fr .9fr;} }

    .card{background:var(--card);border:1px solid var(--line);border-radius:var(--r);box-shadow:var(--shadow)}
    .cardHd{padding:14px 14px 0}
    .cardBd{padding:14px}
    .title{font-weight:700;margin:0 0 6px}
    .sub{color:var(--muted);font-size:14px;margin:0}

    .q{margin:0 0 10px;font-weight:700}
    .options{display:grid;grid-template-columns:1fr;gap:10px}
    @media (min-width:520px){ .options{grid-template-columns:1fr 1fr;} }
    .opt{
      text-align:left; padding:12px; border:1px solid var(--line); border-radius:14px;
      background:#fff; cursor:pointer; transition:.12s; position:relative;
    }
    .opt:hover{transform: translateY(-1px); box-shadow:0 10px 30px rgba(0,0,0,.06)}
    .opt small{display:block;color:var(--muted);margin-top:4px}
    .opt.active{border-color: rgba(47,79,58,.6); outline: 2px solid rgba(47,79,58,.18)}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .pill{font-size:12px;color:#374151;background:var(--soft);border:1px solid var(--line);padding:6px 10px;border-radius:999px}
    .btn{border:1px solid var(--line);background:#fff;border-radius:999px;padding:10px 14px;cursor:pointer}
    .btnPri{background:var(--accent);border-color:var(--accent);color:#fff}
    .btn:active{transform:scale(.99)}
    .muted{color:var(--muted)}
    .hr{height:1px;background:var(--line);margin:12px 0}

    /* Cart bar */
    .cartbar{
      position:sticky; top:0; z-index:50;
      background:rgba(250,247,242,.86); backdrop-filter: blur(10px);
      border-bottom:1px solid var(--line);
    }
    .cartinner{max-width:980px;margin:0 auto;padding:10px 18px;display:flex;gap:10px;align-items:center;justify-content:space-between}
    .cartleft{display:flex;gap:10px;align-items:center;min-width:0}
    .cartcount{font-weight:700}
    .cartitems{color:var(--muted);font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:58vw}
    .drawer{display:none}
    .drawer.open{display:block}
    .drawerBody{padding:14px}
    .item{border:1px solid var(--line);border-radius:14px;padding:10px;background:#fff}
    .itemTop{display:flex;justify-content:space-between;gap:10px}
    .itemName{font-weight:700;margin:0}
    .itemMeta{margin:2px 0 0;color:var(--muted);font-size:13px}
    .qty{display:flex;gap:8px;align-items:center}
    .qty button{width:30px;height:30px;border-radius:10px;border:1px solid var(--line);background:#fff;cursor:pointer}
    .qty span{min-width:18px;text-align:center}
    .danger{color:#b91c1c}

    /* Results */
    .result{display:grid;grid-template-columns:1fr;gap:12px}
    .rCard{border:1px solid var(--line);border-radius:16px;background:#fff;overflow:hidden}
    .rImg{height:120px;background:#f3f4f6;background-size:cover;background-position:center}
    .rBd{padding:12px}
    .rName{margin:0 0 4px;font-weight:800}
    .rMeta{margin:0;color:var(--muted);font-size:13px}
    .why{margin:10px 0 0;color:#374151;font-size:14px}
    .why li{margin:4px 0}
    .footnote{font-size:12px;color:var(--muted);margin-top:10px}
  </style>
</head>

<body>
  <!-- ä½ åªè¦æ”¹é€™æ®µè³‡æ–™å°±å¥½ -->
  <script>
    const CONFIG = {
      brandTitle: "å°æ–‡çš„èŒ¶",
      heroTitle: "ä¸ç”¨æ‡‚èŒ¶ï¼Œä¹Ÿèƒ½é¸åˆ°é©åˆçš„å°ç£èŒ¶",
      heroText: "æˆ‘å€‘æŠŠæ¥è§¸ä¸åŒç”¢åœ°ã€ä¸åŒè£½ç¨‹çš„ç¶“é©—æ•´ç†æˆé¸èŒ¶æ–¹å¼ï¼Œè®“æ‚¨ç”¨ç™½è©±é¸é …å°±èƒ½æŒ‘åˆ°åˆé©çš„é¸æ“‡ã€‚",
      noSampleNotice: "å°æœ¬ç¶“ç‡Ÿï¼Œæ²’æœ‰æä¾›è©¦å–åŒ…ï¼Œé€éé¸èŒ¶æ–¹å¼ï¼Œè®“æ‚¨ä¾ç…§éœ€æ±‚é¸æ“‡åˆé©çš„å•†å“ã€‚",
      imageNote: "åœ–ç‰‡ç‚ºæƒ…å¢ƒç¤ºæ„ï¼Œå¯¦éš›å•†å“ä»¥å‡ºè²¨å…§å®¹ç‚ºæº–ã€‚",
      unitNote: "å–®ä½èªªæ˜ï¼š1 å…© â‰ˆ 37.5gï½œ1 æ–¤ â‰ˆ 600g",
      // ä½ çš„ FB ç²‰å°ˆç§è¨Šé€£çµï¼ˆå…ˆç•™ç©ºä¹Ÿèƒ½è·‘ï¼‰
      messengerUrl: "https://m.me/",

      // é¡Œç›®ï¼ˆç™½è©±ç‰ˆï¼‰
      questions: [
        {
          key: "category",
          title: "Q1ï½œé€™æ¬¡æ‚¨æƒ³æ‰¾çš„æ˜¯ï¼Ÿ",
          options: [
            { value: "tea", label: "ğŸµ èŒ¶", note: "æ—¥å¸¸é£²ç”¨ã€é€ç¦®çš†å¯" },
            { value: "other", label: "ğŸ å…¶ä»–ç‰¹è‰²å•†å“", note: "é¦™è‡ã€èŒ¶ç±½æ²¹ã€èŠ±èœœã€é™³çš®æ¢…é†¬" },
            { value: "pick", label: "ğŸ² ä½ å¹«æˆ‘æŒ‘", note: "ä¸ç”¨æƒ³å¤ªå¤šï¼Œäº¤çµ¦æˆ‘å€‘å¹«æ‚¨æ­é…" }
          ]
        },
        {
          key: "use",
          title: "Q2ï½œé€™æ¬¡æ˜¯ï¼Ÿ",
          options: [
            { value: "self", label: "ğŸ«– è‡ªå·±å–ï¼è‡ªå·±ç”¨", note: "å¹³å¸¸å–ã€æ—¥å¸¸ä½¿ç”¨" },
            { value: "gift", label: "ğŸ é€äºº", note: "å¸Œæœ›å°æ–¹æ”¶åˆ°ä¸å¤±ç¦®" },
            { value: "unsure", label: "ğŸ¤· ä¸ç¢ºå®š", note: "äº¤çµ¦æˆ‘å€‘å¹«æ‚¨åˆ¤æ–·" }
          ]
        },
        {
          key: "feel",
          title: "Q3ï½œæ‚¨å¸Œæœ›å–èµ·ä¾†çš„æ„Ÿè¦ºæ˜¯ï¼Ÿ",
          options: [
            { value: "light", label: "ğŸŒ¸ æ¸…é¦™ã€é †å£å‹", note: "é¦™æ°£ç´°ç·»ï¼Œå£æ„Ÿæ¸…çˆ½ï¼Œä¸åšä¸è‹¦" },
            { value: "balanced", label: "ğŸ™‚ å¹³è¡¡è€å–å‹", note: "é¦™æ°£èˆ‡å£æ„Ÿéƒ½æœ‰ï¼Œä½†ä¸åˆºæ¿€" },
            { value: "bold", label: "ğŸ”¥ é¦™æ°£åšå¯¦å‹", note: "é¦™æ°£æ˜é¡¯ï¼Œå£æ„Ÿè¼ƒåš" },
            { value: "pick", label: "ğŸ² äº¤çµ¦ä½ å€‘å¹«æˆ‘é¸", note: "ä¾å‰é¢æ¢ä»¶å”åŠ©æ¨è–¦" }
          ]
        },
        {
          key: "budget",
          title: "Q4ï½œé€™æ¬¡é ç®—å¤§æ¦‚è½åœ¨å“ªï¼Ÿ",
          options: [
            { value: "daily", label: "ğŸ’° æ—¥å¸¸å–çš„é ç®—", note: "å¤§ç´„å¹¾ç™¾å…ƒç­‰ç´š" },
            { value: "gift", label: "ğŸ æƒ³å–å¥½ä¸€é»ï¼é€äºº", note: "å¸¸è¦‹é€ç¦®åƒ¹ä½" },
            { value: "flavor", label: "â­ è¬›ç©¶é¢¨å‘³", note: "é¢¨å‘³è¡¨ç¾æ˜é¡¯ï¼Œåƒ¹æ ¼è¼ƒé«˜" },
            { value: "rare", label: "ğŸ‘‘ çè—ç­‰ç´š", note: "åƒ¹æ ¼è¼ƒé«˜ï¼Œè¿½æ±‚å“è³ªèˆ‡ç¨€æœ‰æ€§" }
          ]
        },
        {
          key: "flavor",
          title: "Q5ï½œæ‚¨æ¯”è¼ƒåå¥½å“ªä¸€ç¨®ï¼Ÿ",
          options: [
            { value: "fresh", label: "ğŸŒ¿ æ¸…é¦™å‹", note: "åƒèŠ±é¦™ã€è‰é¦™ï¼Œæ¸…æ¸…çš„" },
            { value: "roast", label: "ğŸ”¥ ç„™é¦™å‹", note: "åƒçƒ¤éã€æº«æš–çš„é¦™æ°£" },
            { value: "sweet", label: "ğŸ¯ ç”œæ„Ÿå‹", note: "èœœé¦™ã€å›ç”˜ã€ä¸è‹¦" },
            { value: "pick", label: "ğŸ² ä¸çŸ¥é“", note: "äº¤çµ¦æˆ‘å€‘å¹«æ‚¨æŒ‘" }
          ]
        }
      ],

      // å•†å“è³‡æ–™ï¼šä½ è¦çš„ã€Œé …ç›®ç·¨è™Ÿã€å°±æ˜¯ item
      // ä½ å…ˆæ”¾å¹¾å€‹æ¸¬è©¦å°±å¥½ï¼Œä¹‹å¾Œå†è£œåˆ° 39 é …
      products: [
        // èŒ¶
        { type:"tea", name:"é«˜å±±æ¸…é¦™çƒé¾", item:"8A", origin:"å—æŠ•", tags:{use:["self","gift"], feel:["light","balanced"], budget:["daily","gift","flavor"], flavor:["fresh","sweet"]},
          why:["æ¸…é¦™é †å£ã€è€å–","é©åˆæ—¥å¸¸ä¹Ÿé©åˆé€ç¦®"], priceNote:"ä¾åŒ…è£ä¸åŒç§è¨Šè©¢å•", img:"" , priority:3 },
        { type:"tea", name:"ç„™é¦™çƒé¾", item:"10A", origin:"å—æŠ•", tags:{use:["self","gift"], feel:["balanced","bold"], budget:["gift","flavor","rare"], flavor:["roast"]},
          why:["ç„™é¦™æº«æ½¤ã€é¦™æ°£æ˜é¡¯","é©åˆå–œæ­¡åšå¯¦å£æ„Ÿçš„äºº"], priceNote:"ä¾åŒ…è£ä¸åŒç§è¨Šè©¢å•", img:"", priority:2 },
        { type:"tea", name:"èœœé¦™ç´…èŒ¶", item:"12A", origin:"å°æ±", tags:{use:["self","gift"], feel:["light","balanced"], budget:["daily","gift","flavor"], flavor:["sweet"]},
          why:["ç”œæ„Ÿæ˜é¡¯ã€å¥½å…¥å£","é€äººå®‰å…¨ã€æ¥å—åº¦é«˜"], priceNote:"ä¾åŒ…è£ä¸åŒç§è¨Šè©¢å•", img:"", priority:2 },

        // éèŒ¶
        { type:"other", name:"é«˜å±±é¦™è‡", item:"35", origin:"å—æŠ•", tags:{use:["self","gift"], feel:["pick"], budget:["daily","gift","flavor","rare"], flavor:["pick"]},
          why:["ç…®æ¹¯ç‚’èœéƒ½æ–¹ä¾¿","é€é•·è¼©å¾ˆå®‰å…¨"], priceNote:"ä¾è¦æ ¼ä¸åŒç§è¨Šè©¢å•", img:"", priority:3 },
        { type:"other", name:"èŒ¶ç±½æ²¹", item:"36", origin:"å°ç£", tags:{use:["self","gift"], feel:["pick"], budget:["gift","flavor","rare"], flavor:["pick"]},
          why:["æ—¥å¸¸æ–™ç†ã€æ‹Œéºµæ‹Œèœéƒ½åˆé©","é€ç¦®é«”é¢åˆå¯¦ç”¨"], priceNote:"ä¾è¦æ ¼ä¸åŒç§è¨Šè©¢å•", img:"", priority:2 },
        { type:"other", name:"èŠ±èœœ", item:"37", origin:"å°ç£", tags:{use:["self","gift"], feel:["pick"], budget:["daily","gift"], flavor:["sweet","pick"]},
          why:["å£å‘³å¥½æ‡‚ã€æ¥å—åº¦é«˜","æ­é…é€ç¦®å¾ˆåŠ åˆ†"], priceNote:"ä¾è¦æ ¼ä¸åŒç§è¨Šè©¢å•", img:"", priority:1 },
        { type:"other", name:"é™³çš®æ¢…é†¬", item:"38", origin:"å°ç£", tags:{use:["self","gift"], feel:["pick"], budget:["daily","gift"], flavor:["pick"]},
          why:["æ–™ç†ç™¾æ­ã€å¾ˆæœ‰è¨˜æ†¶é»","å¢åŠ ç¦®ç›’è±å¯Œåº¦"], priceNote:"ä¾è¦æ ¼ä¸åŒç§è¨Šè©¢å•", img:"", priority:1 },
      ],

      // éèŒ¶ï¼šå›ºå®šã€Œä¸»æ¨ 1 + æ›å…‰ 1ã€
      otherPickCount: 2,
    };
  </script>

  <!-- ä¸Šæ–¹æš«å­˜æ¸…å–®æ¢ -->
  <div class="cartbar">
    <div class="cartinner">
      <div class="cartleft">
        <span class="cartcount" id="cartCount">ğŸ›’ å°šæœªé¸æ“‡å•†å“</span>
        <span class="cartitems" id="cartItems"></span>
      </div>
      <div class="row">
        <button class="btn" id="btnCart">æŸ¥çœ‹ï¼ä¿®æ”¹</button>
        <button class="btn btnPri" id="btnMsg">è©¢å•ï¼ä¸‹å–®</button>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="hero card">
      <div class="heroImg" id="heroImg"></div>
      <div class="heroBody">
        <h1 id="heroTitle"></h1>
        <p class="lead" id="heroText"></p>
        <div class="notice" id="noSample"></div>
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <div class="cardHd">
          <p class="title">é–‹å§‹é¸æ“‡</p>
          <p class="sub">é¸å®Œå°±æœƒç›´æ¥æ¨è–¦ï¼Œæ‚¨ä¹Ÿå¯ä»¥éš¨æ™‚ä¿®æ”¹ã€‚</p>
        </div>
        <div class="cardBd" id="quiz"></div>
      </div>

      <div class="card">
        <div class="cardHd">
          <p class="title">æ¨è–¦çµæœ</p>
          <p class="sub">æœƒé¡¯ç¤ºé …ç›®ç·¨è™Ÿã€ç”¢åœ°èˆ‡æ¨è–¦ç†ç”±ã€‚</p>
        </div>
        <div class="cardBd">
          <div class="result" id="results"></div>
          <div class="footnote" id="unitNote"></div>
          <div class="footnote" id="imgNote"></div>
        </div>
      </div>
    </div>

    <div class="card drawer" id="cartDrawer">
      <div class="cardHd">
        <p class="title">æš«å­˜æ¸…å–®</p>
        <p class="sub">å¯èª¿æ•´æ•¸é‡æˆ–ç§»é™¤ï¼Œå•†å“æœƒè¢«è¨˜ä½ï¼ˆä¸å­˜å€‹è³‡ï¼‰ã€‚</p>
      </div>
      <div class="drawerBody" id="cartBody"></div>
    </div>

    <p class="footnote" style="margin-top:14px">Â© <span id="brand"></span></p>
  </div>

  <script>
    // ========= å°å·¥å…· =========
    const $ = (id)=>document.getElementById(id);
    const LS_KEY = "xiaowen_tea_cart_v1";
    const LS_ANS = "xiaowen_tea_answers_v1";

    const state = {
      answers: JSON.parse(localStorage.getItem(LS_ANS) || "{}"),
      cart: JSON.parse(localStorage.getItem(LS_KEY) || "[]"),
    };

    function save(){
      localStorage.setItem(LS_KEY, JSON.stringify(state.cart));
      localStorage.setItem(LS_ANS, JSON.stringify(state.answers));
    }

    function heroSetup(){
      $("heroTitle").textContent = CONFIG.heroTitle;
      $("heroText").textContent = CONFIG.heroText;
      $("noSample").textContent = CONFIG.noSampleNotice;
      $("unitNote").textContent = CONFIG.unitNote;
      $("imgNote").textContent = CONFIG.imageNote;
      $("brand").textContent = CONFIG.brandTitle;

      // æƒ…å¢ƒåœ–ï¼šä½ ä»¥å¾Œæœ‰è‡ªå·±çš„åœ–ï¼Œå°±æ›æˆè‡ªå·±çš„ï¼›ç›®å‰ç”¨ç´”è‰²ä¹Ÿä¸æœƒå£
      $("heroImg").style.backgroundImage = "linear-gradient(135deg, rgba(47,79,58,.12), rgba(0,0,0,0)), radial-gradient(circle at 30% 20%, rgba(255,255,255,.9), rgba(255,255,255,0))";
    }

    function renderQuiz(){
      const root = $("quiz");
      root.innerHTML = "";

      CONFIG.questions.forEach((q, idx)=>{
        const box = document.createElement("div");
        box.style.marginBottom = "14px";

        const head = document.createElement("div");
        head.className="row";
        head.style.justifyContent="space-between";

        const qTitle = document.createElement("p");
        qTitle.className="q";
        qTitle.textContent = q.title;

        const chosen = document.createElement("span");
        chosen.className="pill";
        chosen.textContent = state.answers[q.key] ? `å·²é¸ï¼š${labelOf(q.key, state.answers[q.key])}` : "å°šæœªé¸";

        head.appendChild(qTitle);
        head.appendChild(chosen);

        const opts = document.createElement("div");
        opts.className="options";

        q.options.forEach(opt=>{
          const btn = document.createElement("button");
          btn.type="button";
          btn.className="opt";
          if(state.answers[q.key] === opt.value) btn.classList.add("active");
          btn.innerHTML = `<div>${opt.label}</div><small>${opt.note || ""}</small>`;
          btn.onclick = ()=>{
            state.answers[q.key] = opt.value;
            save();
            renderQuiz();
            renderResults();
          };
          opts.appendChild(btn);
        });

        box.appendChild(head);
        box.appendChild(opts);
        root.appendChild(box);
      });

      const actions = document.createElement("div");
      actions.className="row";
      actions.innerHTML = `
        <button class="btn" id="btnReset">æ¸…ç©ºé¸æ“‡</button>
        <button class="btn" id="btnResetCart">æ¸…ç©ºæš«å­˜æ¸…å–®</button>
      `;
      root.appendChild(actions);

      $("btnReset").onclick = ()=>{
        state.answers = {};
        save();
        renderQuiz();
        renderResults();
      };
      $("btnResetCart").onclick = ()=>{
        state.cart = [];
        save();
        renderCartBar();
        renderCartDrawer();
      };
    }

    function labelOf(key, value){
      const q = CONFIG.questions.find(x=>x.key===key);
      if(!q) return value;
      const opt = q.options.find(o=>o.value===value);
      return opt ? opt.label.replace(/[^\p{L}\p{N}\s\-\â€”\u4e00-\u9fff]/gu,"").trim() : value;
    }

    function matchScore(p){
      // é¡åˆ¥åˆ†æµ
      const cat = state.answers.category;
      let typeWanted = cat === "pick" ? "tea" : cat; // ä½ å¹«æˆ‘æŒ‘ï¼šé è¨­èŒ¶ï¼ˆä¹Ÿå¯åœ¨ä¸‹é¢å†åŠ è¦å‰‡ï¼‰
      if(p.type !== (typeWanted==="other"?"other":"tea")) return -999;

      // è¨ˆåˆ†
      let score = 0;
      const use = state.answers.use;
      const feel = state.answers.feel;
      const budget = state.answers.budget;
      const flavor = state.answers.flavor;

      if(use && p.tags.use?.includes(use)) score += 3;
      if(feel && (feel==="pick" ? true : p.tags.feel?.includes(feel))) score += 3;
      if(budget && p.tags.budget?.includes(budget)) score += 2;
      if(flavor && (flavor==="pick" ? true : p.tags.flavor?.includes(flavor))) score += 2;

      score += (p.priority || 0); // ä½ å¯ç”¨ priority æ§åˆ¶ä¸»æ¨
      return score;
    }

    function pickProducts(){
      const cat = state.answers.category;
      // è‹¥æ²’é¸ä»»ä½•ï¼Œå°±ä¸é¡¯ç¤º
      if(!cat) return [];

      if(cat === "other"){
        const others = CONFIG.products.filter(p=>p.type==="other").sort((a,b)=>matchScore(b)-matchScore(a));
        return others.slice(0, CONFIG.otherPickCount);
      }

      // tea æˆ– pick
      const teas = CONFIG.products.filter(p=>p.type==="tea").sort((a,b)=>matchScore(b)-matchScore(a));
      // ä¸»æ¨ 1 + å‚™é¸ 2ï¼ˆå›ºå®š 3ï¼‰
      return teas.slice(0,3);
    }

    function renderResults(){
      const root = $("results");
      root.innerHTML = "";

      const picked = pickProducts();
      if(picked.length === 0){
        root.innerHTML = `<p class="muted">è«‹å…ˆå®Œæˆå·¦å´é¸æ“‡ï¼Œé€™è£¡å°±æœƒå‡ºç¾æ¨è–¦çµæœã€‚</p>`;
        return;
      }

      picked.forEach((p, i)=>{
        const card = document.createElement("div");
        card.className="rCard";

        const img = document.createElement("div");
        img.className="rImg";
        if(p.img){
          img.style.backgroundImage = `url("${p.img}")`;
        }else{
          img.style.backgroundImage = "linear-gradient(135deg, rgba(47,79,58,.10), rgba(0,0,0,0)), radial-gradient(circle at 60% 30%, rgba(255,255,255,.95), rgba(255,255,255,0))";
        }

        const bd = document.createElement("div");
        bd.className="rBd";
        const rank = (state.answers.category==="other")
          ? (i===0 ? "â­ ä¸»æ¨" : "â—»ï¸ ä¹Ÿå¾ˆé©åˆæ‚¨")
          : (i===0 ? "â­ ä¸»æ¨" : "â—»ï¸ ä¹Ÿå¾ˆé©åˆæ‚¨");

        bd.innerHTML = `
          <div class="row" style="justify-content:space-between;align-items:flex-start">
            <div>
              <div class="pill">${rank}</div>
              <h3 class="rName">${p.name}</h3>
              <p class="rMeta">é …ç›®ç·¨è™Ÿï¼š<b>${p.item}</b> ï½œ ç”¢åœ°ï¼š<b>${p.origin}</b></p>
              <p class="rMeta">åƒè€ƒï¼š${p.priceNote || "ç§è¨Šè©¢å•"}</p>
            </div>
            <button class="btn btnPri">ï¼‹åŠ å…¥æš«å­˜</button>
          </div>
          <ul class="why">
            ${(p.why || []).map(x=>`<li>${x}</li>`).join("")}
          </ul>
        `;

        bd.querySelector("button").onclick = ()=> addToCart(p);

        card.appendChild(img);
        card.appendChild(bd);
        root.appendChild(card);
      });
    }

    function addToCart(p){
      const existing = state.cart.find(x=>x.item===p.item);
      if(existing) existing.qty += 1;
      else state.cart.push({ item:p.item, name:p.name, origin:p.origin, qty:1, type:p.type });
      save();
      renderCartBar();
      renderCartDrawer();
      window.scrollTo({ top: 0, behavior:"smooth" });
    }

    function renderCartBar(){
      const count = state.cart.reduce((s,x)=>s+x.qty,0);
      if(count===0){
        $("cartCount").textContent = "ğŸ›’ å°šæœªé¸æ“‡å•†å“";
        $("cartItems").textContent = "";
      }else{
        $("cartCount").textContent = `ğŸ›’ å·²é¸ ${count} ä»¶`;
        const names = state.cart.map(x=>`${x.name}ï¼ˆ${x.item}ï¼‰Ã—${x.qty}`).join("ã€");
        $("cartItems").textContent = names;
      }
    }

    function renderCartDrawer(){
      const body = $("cartBody");
      body.innerHTML = "";

      if(state.cart.length===0){
        body.innerHTML = `<p class="muted">ç›®å‰æš«å­˜æ¸…å–®æ˜¯ç©ºçš„ã€‚æ‚¨å¯ä»¥å…ˆå®Œæˆé¸æ“‡ï¼Œå°‡å–œæ­¡çš„å“é …åŠ å…¥æš«å­˜ã€‚</p>`;
        return;
      }

      state.cart.forEach((x)=>{
        const div = document.createElement("div");
        div.className="item";
        div.style.marginBottom="10px";
        div.innerHTML = `
          <div class="itemTop">
            <div>
              <p class="itemName">${x.name}</p>
              <p class="itemMeta">é …ç›®ç·¨è™Ÿï¼š<b>${x.item}</b> ï½œ ç”¢åœ°ï¼š<b>${x.origin}</b></p>
            </div>
            <div class="qty">
              <button aria-label="minus">ï¼</button>
              <span>${x.qty}</span>
              <button aria-label="plus">ï¼‹</button>
            </div>
          </div>
          <div class="hr"></div>
          <button class="btn danger">ç§»é™¤</button>
        `;
        const [minus, plus] = div.querySelectorAll(".qty button");
        const remove = div.querySelector(".danger");
        minus.onclick = ()=>{
          x.qty = Math.max(1, x.qty-1);
          save(); renderCartBar(); renderCartDrawer();
        };
        plus.onclick = ()=>{
          x.qty += 1;
          save(); renderCartBar(); renderCartDrawer();
        };
        remove.onclick = ()=>{
          state.cart = state.cart.filter(t=>t.item!==x.item);
          save(); renderCartBar(); renderCartDrawer();
        };
        body.appendChild(div);
      });

      body.insertAdjacentHTML("beforeend", `
        <div class="hr"></div>
        <div class="row">
          <button class="btn" id="btnContinue">ç¹¼çºŒæŒ‘é¸</button>
          <button class="btn btnPri" id="btnMsg2">è©¢å•ï¼ä¸‹å–®</button>
        </div>
      `);
      $("btnContinue").onclick = ()=>{ $("cartDrawer").classList.remove("open"); window.scrollTo({top:0, behavior:"smooth"}); };
      $("btnMsg2").onclick = ()=> openMessenger();
    }

    function openMessenger(){
      if(!state.cart.length){
        alert("ç›®å‰æš«å­˜æ¸…å–®æ˜¯ç©ºçš„ï¼Œè«‹å…ˆåŠ å…¥å•†å“ã€‚");
        return;
      }
      const lines = [];
      lines.push("ä½ å¥½ï¼Œæˆ‘åœ¨å°æ–‡çš„èŒ¶é¸äº†ä»¥ä¸‹å•†å“ï¼š");
      lines.push("");
      state.cart.forEach(x=>{
        lines.push(`ãƒ»${x.name}ï¼ˆé …ç›®${x.item}ï¼‰Ã—${x.qty}`);
      });
      lines.push("");
      lines.push("æƒ³è«‹æ‚¨å¹«æˆ‘ç¢ºèªåƒ¹æ ¼èˆ‡ä¸‹å–®æ–¹å¼ï¼Œè¬è¬ã€‚");

      const text = encodeURIComponent(lines.join("\n"));
      // è‹¥ä½ æä¾›å®Œæ•´ç²‰å°ˆ m.me é€£çµï¼Œå¯ç›´æ¥ç”¨ï¼›å¦å‰‡å…ˆè¤‡è£½æ–‡å­—
      const url = CONFIG.messengerUrl && CONFIG.messengerUrl !== "https://m.me/"
        ? `${CONFIG.messengerUrl}?ref=${text}`
        : "";

      if(url){
        window.open(url, "_blank");
      }else{
        navigator.clipboard?.writeText(lines.join("\n"));
        alert("æˆ‘å·²å¹«ä½ æŠŠè©¢å•æ–‡å­—è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼ˆè‹¥æœªæˆåŠŸï¼Œè«‹æ‰‹å‹•è¤‡è£½ç•«é¢æ–‡å­—ï¼‰ã€‚\n\n" + lines.join("\n"));
      }
    }

    function wireUI(){
      $("btnCart").onclick = ()=>{ $("cartDrawer").classList.toggle("open"); renderCartDrawer(); };
      $("btnMsg").onclick = ()=> openMessenger();
    }

    // åˆå§‹åŒ–
    heroSetup();
    wireUI();
    renderQuiz();
    renderResults();
    renderCartBar();
    renderCartDrawer();
  </script>
</body>
</html>
