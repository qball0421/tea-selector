<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å°æ–‡çš„èŒ¶ï½œé¸èŒ¶å™¨</title>
  <style>
    :root{
      --bg:#faf7f2;
      --card:#ffffff;
      --ink:#1f2937;
      --muted:#6b7280;
      --line:#e5e7eb;
      --accent:#2f4f3a;
      --soft:#f4efe6;
      --shadow: 0 8px 30px rgba(0,0,0,.06);
      --r:16px;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font-family: system-ui,-apple-system,"Noto Sans TC","PingFang TC","Microsoft JhengHei",sans-serif;line-height:1.55}
    a{color:var(--accent);text-decoration:none}
    .wrap{max-width:980px;margin:0 auto;padding:14px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:var(--r);box-shadow:var(--shadow)}
    .hero{padding:14px}
    h1{margin:0 0 6px;font-size:20px;letter-spacing:.2px}
    .lead{margin:0;color:var(--muted);font-size:14px}
    .mini{margin-top:8px;color:#374151;font-size:13px;background:var(--soft);border:1px solid var(--line);padding:10px 12px;border-radius:12px}
    .grid{display:grid;grid-template-columns:1fr;gap:12px;margin-top:12px}
    @media (min-width:920px){ .grid{grid-template-columns: 1.05fr .95fr;} }

    .cardHd{padding:14px 14px 0}
    .cardBd{padding:14px}
    .title{font-weight:800;margin:0 0 6px}
    .sub{color:var(--muted);font-size:13px;margin:0}

    .q{margin:0 0 10px;font-weight:800}
    .options{display:grid;grid-template-columns:1fr;gap:10px}
    @media (min-width:520px){ .options{grid-template-columns:1fr 1fr;} }
    .opt{
      text-align:left; padding:12px; border:1px solid var(--line); border-radius:14px;
      background:#fff; cursor:pointer; transition:.12s; position:relative;
    }
    .opt:hover{transform: translateY(-1px); box-shadow:0 10px 30px rgba(0,0,0,.06)}
    .opt small{display:block;color:var(--muted);margin-top:4px}
    .opt.active{border-color: rgba(47,79,58,.6); outline: 2px solid rgba(47,79,58,.16)}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .pill{font-size:12px;color:#374151;background:var(--soft);border:1px solid var(--line);padding:6px 10px;border-radius:999px}
    .btn{border:1px solid var(--line);background:#fff;border-radius:999px;padding:10px 14px;cursor:pointer}
    .btnPri{background:var(--accent);border-color:var(--accent);color:#fff}
    .btn:active{transform:scale(.99)}
    .muted{color:var(--muted)}
    .hr{height:1px;background:var(--line);margin:12px 0}

    /* Cart bar */
    .cartbar{
      position:sticky; top:0; z-index:50;
      background:rgba(250,247,242,.92); backdrop-filter: blur(10px);
      border-bottom:1px solid var(--line);
    }
    .cartinner{max-width:980px;margin:0 auto;padding:10px 14px;display:flex;gap:10px;align-items:center;justify-content:space-between}
    .cartleft{display:flex;gap:10px;align-items:center;min-width:0}
    .cartcount{font-weight:800}
    .cartitems{color:var(--muted);font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:58vw}

    /* Drawer */
    .drawer{display:none}
    .drawer.open{display:block}
    .drawerBody{padding:14px}
    .item{border:1px solid var(--line);border-radius:14px;padding:10px;background:#fff}
    .itemTop{display:flex;justify-content:space-between;gap:10px}
    .itemName{font-weight:800;margin:0}
    .itemMeta{margin:2px 0 0;color:var(--muted);font-size:13px}
    .qty{display:flex;gap:8px;align-items:center}
    .qty button{width:30px;height:30px;border-radius:10px;border:1px solid var(--line);background:#fff;cursor:pointer}
    .qty span{min-width:18px;text-align:center}
    .danger{color:#b91c1c}

    /* Results cards */
    .result{display:grid;grid-template-columns:1fr;gap:12px}
    .rCard{border:1px solid var(--line);border-radius:16px;background:#fff;overflow:hidden}
    .rBd{padding:12px}
    .rName{margin:8px 0 4px;font-weight:900}
    .rMeta{margin:0;color:var(--muted);font-size:13px}
    .why{margin:10px 0 0;color:#374151;font-size:14px}
    .why li{margin:4px 0}
    .footnote{font-size:12px;color:var(--muted);margin-top:10px}

    /* Catalog */
    .catalogTop{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between}
    .search{flex:1;min-width:220px}
    input[type="search"]{
      width:100%; padding:10px 12px; border-radius:12px; border:1px solid var(--line); background:#fff;
      outline:none;
    }
    details{border:1px solid var(--line);border-radius:14px;background:#fff}
    summary{cursor:pointer;list-style:none;padding:12px 14px;font-weight:800}
    summary::-webkit-details-marker{display:none}
    .catalogList{padding:0 14px 14px}
    .cRow{
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px;
      margin-top:10px;
      background:#fff;
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:flex-start;
    }
    .cLeft{min-width:0}
    .cName{margin:0;font-weight:900}
    .cMeta{margin:2px 0 0;color:var(--muted);font-size:13px}
    .cPrice{margin:6px 0 0;font-weight:900}
    .footer-protect-notice{
      font-size:12px;color:#6b7280;text-align:center;padding:10px 12px;margin-top:14px;border-top:1px solid #e5e7eb;line-height:1.4
    }
  </style>
</head>

<body>
<script>
  const CONFIG = {
    brandTitle: "å°æ–‡çš„èŒ¶",
    heroTitle: "ä¸ç”¨æ‡‚èŒ¶ï¼Œä¹Ÿèƒ½é¸åˆ°é©åˆçš„å•†å“",
    heroText: "ç”¨ç™½è©±é¸é …å¿«é€Ÿç¯©é¸ï¼Œä¹Ÿå¯ç›´æ¥çœ‹å®Œæ•´ç›®éŒ„åŠ å…¥è³¼ç‰©è»Šã€‚",
    noSampleNotice: "å°æœ¬ç¶“ç‡Ÿï¼Œæ²’æœ‰æä¾›è©¦å–åŒ…ï¼›é€éé¸èŒ¶æ–¹å¼ï¼Œè®“æ‚¨ä¾ç…§éœ€æ±‚é¸æ“‡åˆé©çš„å•†å“ã€‚",
    unitNote: "å–®ä½åƒè€ƒï¼šå››å…©ï¼150gï¼ˆå¸¸è¦‹èŒ¶è‘‰åŒ…è£ï¼‰ï½œåŠæ–¤ï¼300gï½œä¸€æ–¤ï¼600g",
    messengerUrl: "https://m.me/",

    questions: [
      {
        key: "category",
        title: "Q1ï½œé€™æ¬¡æ‚¨æƒ³æ‰¾çš„æ˜¯ï¼Ÿ",
        options: [
          { value: "tea", label: "ğŸµ èŒ¶", note: "ä¾ç”¨é€”ã€æ¿ƒæ·¡ã€é ç®—èˆ‡é¢¨å‘³æ¨è–¦" },
          { value: "other", label: "ğŸ ç‰¹è‰²å•†å“", note: "é¦™è‡ï¼èœ‚èœœï¼èŒ¶ç±½æ²¹ï¼æ¢…é†¬â€¦ç›´æ¥æ¨è–¦" },
          { value: "pick", label: "ğŸ² ä½ å¹«æˆ‘æŒ‘", note: "ä¸æƒ³æƒ³å¤ªå¤šï¼Œäº¤çµ¦æˆ‘å€‘æ­é…" }
        ]
      },
      {
        key: "use",
        title: "Q2ï½œé€™æ¬¡æ˜¯ï¼Ÿ",
        options: [
          { value: "self", label: "ğŸ«– è‡ªå·±å–ï¼è‡ªå·±ç”¨", note: "æ—¥å¸¸å–ã€è€å–ã€åˆ’ç®—" },
          { value: "gift", label: "ğŸ é€äºº", note: "å¸Œæœ›é«”é¢ã€æ¥å—åº¦é«˜" },
          { value: "unsure", label: "ğŸ¤· ä¸ç¢ºå®š", note: "äº¤çµ¦æˆ‘å€‘åˆ¤æ–·" }
        ]
      },
      {
        key: "feel",
        title: "Q3ï½œæ‚¨å¸Œæœ›å–èµ·ä¾†çš„æ„Ÿè¦ºæ˜¯ï¼Ÿ",
        options: [
          { value: "light", label: "ğŸŒ¿ æ¸…é¦™é †å£", note: "é¦™æ°£ç´°ç·»ã€å£æ„Ÿæ¸…çˆ½" },
          { value: "balanced", label: "ğŸ™‚ å¹³è¡¡è€å–", note: "é¦™æ°£èˆ‡å£æ„Ÿéƒ½æœ‰ï¼Œä½†ä¸åˆºæ¿€" },
          { value: "bold", label: "ğŸ”¥ é¦™æ°£åšå¯¦", note: "ç„™é¦™æˆ–åšéŸ»ï¼Œå­˜åœ¨æ„Ÿæ›´æ˜é¡¯" },
          { value: "pick", label: "ğŸ² äº¤çµ¦ä½ å€‘", note: "æˆ‘ä¸ç¢ºå®š" }
        ]
      },
      {
        key: "budget",
        title: "Q4ï½œé€™æ¬¡é ç®—å¤§æ¦‚æ˜¯ï¼Ÿ",
        options: [
          { value: "daily", label: "ğŸ’° æ—¥å¸¸å–", note: "å¤§ç´„ NT$ 250â€“400 / åŒ…" },
          { value: "gift", label: "ğŸ é€ç¦®å‰›å¥½", note: "å¤§ç´„ NT$ 500â€“800 / åŒ…" },
          { value: "flavor", label: "â­ è¬›ç©¶é¢¨å‘³", note: "å¤§ç´„ NT$ 900â€“1200 / åŒ…" },
          { value: "rare", label: "ğŸ‘‘ çè—ç­‰ç´š", note: "å¤§ç´„ NT$ 1400â†‘ / åŒ…" }
        ]
      },
      {
        key: "flavor",
        title: "Q5ï½œæ‚¨æ¯”è¼ƒåå¥½å“ªä¸€ç¨®ï¼Ÿ",
        options: [
          { value: "fresh", label: "ğŸŒ¸ æ¸…é¦™å‹", note: "èŠ±é¦™ã€æ¸…é¦™ã€æ¸…çˆ½" },
          { value: "roast", label: "ğŸ”¥ ç„™é¦™å‹", note: "çƒ˜ç„™é¦™ã€æº«æš–åšéŸ»" },
          { value: "sweet", label: "ğŸ¯ ç”œæ„Ÿå‹", note: "èœœé¦™ã€ç„¦ç³–é¦™ã€å›ç”˜" },
          { value: "pick", label: "ğŸ² ä¸çŸ¥é“", note: "äº¤çµ¦æˆ‘å€‘æŒ‘" }
        ]
      }
    ],

    // âœ… å…¨éƒ¨å•†å“ï¼ˆä»¥ã€Œå¯¦éš›å”®åƒ¹ã€ç‚ºä¸»ï¼šä¸€åŒ…/ä¸€è¢‹/ä¸€ç›’â€¦ï¼‰
    products: [
      // 1â€“27 èŒ¶
      { type:"tea", item:"1", name:"ç¶œåˆçƒ˜ç„™å† è»èŒ¶æ", origin:"å„åœ°å€è²¨åº•æ··åˆçƒ˜ç„™", pack:"ä¸€æ–¤è£", price:200, note:"æ¯”è³½åŠŸå¤«åŠç”Ÿç†Ÿçƒ˜ç„™èŒ¶æ" },
      { type:"tea", item:"2", name:"ç¶œåˆçƒ˜ç„™èŒ¶ï¼ˆå¤§å£ºèŒ¶ï¼‰", origin:"å„åœ°å€è²¨åº•æ··åˆçƒ˜ç„™", pack:"ä¸€æ–¤è£", price:500, note:"åŠç”Ÿç†Ÿçƒ˜ç„™èŒ¶" },
      { type:"tea", item:"3", name:"æ©Ÿæ¡å››å­£æ˜¥ï¼ˆæ­¡æ¨‚èŒ¶åœ’ï¼‰", origin:"é›²æ—å¤å‘", pack:"åŠæ–¤è£", price:300, note:"æ­£å¸¸ç™¼é…µï¼ç„¡çƒ˜ç„™" },
      { type:"tea", item:"3A", name:"æ©Ÿæ¡å››å­£æ˜¥ï¼ˆå¤§åŒ… 5gÃ—30åŒ…ï¼‰", origin:"", pack:"çœŸç©ºè¢‹ï¼ˆå¤§ï¼‰", price:400, note:"å¹³å‡æ¯åŒ…èŒ¶åŒ…ç´„ 13.4 å…ƒ" },
      { type:"tea", item:"4", name:"ç²¾ç·»çƒ˜ç„™æ©Ÿæ¡å››å­£æ˜¥", origin:"é›²æ—å¤å‘", pack:"å››å…©è£", price:200, note:"æ­£å¸¸ç™¼é…µï¼æ¯”è³½èŒ¶çƒ˜ç„™" },
      { type:"tea", item:"4A", name:"æ©Ÿæ¡å››å­£æ˜¥ï¼ˆå¤§åŒ… 5gÃ—30åŒ…ï¼‰", origin:"", pack:"çœŸç©ºè¢‹ï¼ˆå¤§ï¼‰", price:400, note:"å¹³å‡æ¯åŒ…èŒ¶åŒ…ç´„ 13.4 å…ƒ" },
      { type:"tea", item:"5", name:"æ©Ÿæ¡ç´…èŒ¶ï¼ˆç¢èŒ¶ï¼‰", origin:"å—æŠ•ç«¹å±±", pack:"å››å…©è£", price:200, note:"é‡ç™¼é…µï¼é‡çƒ˜ç„™ï¼é¾çœ¼ä¹¾é¦™" },
      { type:"tea", item:"6", name:"é¦™ç‰‡ï¼ˆèŒ‰è‰èŠ±èŒ¶ï¼‰", origin:"å—æŠ•", pack:"å››å…©è£", price:300, note:"è¼•ç™¼é…µï¼è¼•çƒ˜ç„™è–°èŒ‰è‰èŠ±" },
      { type:"tea", item:"7", name:"æ‹›ç‰Œæ©Ÿæ¡å››å­£æ˜¥ å°èŒ¶19è™Ÿç¢§ç‰", origin:"æ¯”è³½èŒ¶é ­ç­‰çèŒ¶åœ’", pack:"åŠæ–¤è£", price:600, note:"æ­£å¸¸ç™¼é…µï¼ç„¡çƒ˜ç„™" },
      { type:"tea", item:"7A", name:"æ©Ÿæ¡å››å­£æ˜¥ï¼ˆå¤§åŒ… 5gÃ—30åŒ…ï¼‰", origin:"", pack:"çœŸç©ºè¢‹ï¼ˆå¤§ï¼‰", price:540, note:"å¹³å‡æ¯åŒ…èŒ¶åŒ…ç´„ 18 å…ƒ" },
      { type:"tea", item:"8", name:"ç´…çƒé¾ï¼ˆçƒç‹€çƒå‹ç´…èŒ¶ï¼‰", origin:"å°æ±é¹¿é‡", pack:"å››å…©è£", price:400, note:"æ˜é¡¯ç³–é¦™ï¼æ°´ç”œ" },
      { type:"tea", item:"8A", name:"ç´…çƒé¾ï¼ˆå¤§åŒ… 5gÃ—30åŒ…ï¼‰", origin:"", pack:"çœŸç©ºè¢‹ï¼ˆå¤§ï¼‰", price:610, note:"å¹³å‡æ¯åŒ…èŒ¶åŒ…ç´„ 20.4 å…ƒ" },
      { type:"tea", item:"9", name:"ç²¾ç·»çƒ˜ç„™æ©Ÿæ¡å››å­£æ˜¥", origin:"é¹¿è°·å°åŠå¤©", pack:"åŠæ–¤è£", price:800, note:"é‡ç™¼é…µï¼é‡çƒ˜ç„™" },
      { type:"tea", item:"10", name:"é ‚ç´šæ©Ÿæ¡å››å­£æ˜¥ å°èŒ¶20è™Ÿè¿é¦™", origin:"æ¯”è³½èŒ¶é ­ç­‰çèŒ¶åœ’", pack:"åŠæ–¤è£", price:800, note:"æ­£å¸¸ç™¼é…µï¼ç„¡çƒ˜ç„™" },
      { type:"tea", item:"10A", name:"æ©Ÿæ¡å››å­£æ˜¥ï¼ˆå¤§åŒ… 5gÃ—30åŒ…ï¼‰", origin:"", pack:"çœŸç©ºè¢‹ï¼ˆå¤§ï¼‰", price:584, note:"å¹³å‡æ¯åŒ…èŒ¶åŒ…ç´„ 19.6 å…ƒ" },
      { type:"tea", item:"11", name:"æ‰‹æ¡çƒé¾èŒ¶", origin:"æ‹‰æ‹‰å±±ï¼å£«åŒªå±±", pack:"åŠæ–¤è£", price:800, note:"é‡ç™¼é…µï¼è¼•çƒ˜ç„™" },
      { type:"tea", item:"11A", name:"æ‰‹æ¡çƒé¾èŒ¶ï¼ˆå¤§åŒ… 5gÃ—30åŒ…ï¼‰", origin:"", pack:"çœŸç©ºè¢‹ï¼ˆå¤§ï¼‰", price:680, note:"å¹³å‡æ¯åŒ…èŒ¶åŒ…ç´„ 22.8 å…ƒ" },
      { type:"tea", item:"12", name:"æ‰‹æ¡é‡‘è±èŒ¶", origin:"æ‰æ—æºªï¼é¹¿è°·é³³å‡°å±±", pack:"åŠæ–¤è£", price:1000, note:"è¼•æœé¦™" },
      { type:"tea", item:"12A", name:"æ‰‹æ¡é‡‘è±èŒ¶ï¼ˆå¤§åŒ… 5gÃ—30åŒ…ï¼‰", origin:"", pack:"çœŸç©ºè¢‹ï¼ˆå¤§ï¼‰", price:750, note:"å¹³å‡æ¯åŒ…èŒ¶åŒ…ç´„ 25 å…ƒ" },
      { type:"tea", item:"13", name:"é«˜å±±æ‰‹æ¡é‡‘è±èŒ¶", origin:"é˜¿é‡Œå±±ï¼æ¢…å±±é¾ç›®æ¨“ï¼ˆ1550mï¼‰", pack:"å››å…©è£", price:600, note:"ä¸­é‡ç™¼é…µèŠ±æœé¦™" },
      { type:"tea", item:"13A", name:"é«˜å±±æ‰‹æ¡é‡‘è±èŒ¶ï¼ˆå¤§åŒ… 5gÃ—30åŒ…ï¼‰", origin:"", pack:"çœŸç©ºè¢‹ï¼ˆå¤§ï¼‰", price:890, note:"å¹³å‡æ¯åŒ…èŒ¶åŒ…ç´„ 29.8 å…ƒ" },
      { type:"tea", item:"14", name:"æ‰‹æ¡é‡‘è±èŒ¶ï¼çƒé¾èŒ¶ï¼ˆå¯æŒ‘é¸ï¼‰", origin:"é”é‚¦ï¼ç¾Šä»”ç£", pack:"å››å…©è£", price:800, note:"å¤šç¨®èŒ¶æ¬¾å¯æŒ‘é¸" },
      { type:"tea", item:"14A-1", name:"æ‰‹æ¡çƒé¾èŒ¶ï¼ˆæ‰æ—æºªç¾Šä»”ç£ï½œå¤§åŒ… 5gÃ—30åŒ…ï¼‰", origin:"æ‰æ—æºªç¾Šä»”ç£", pack:"çœŸç©ºè¢‹ï¼ˆå¤§ï¼‰", price:1140, note:"å¹³å‡æ¯åŒ…èŒ¶åŒ…ç´„ 38 å…ƒ" },
      { type:"tea", item:"14A-2", name:"æ‰‹æ¡çƒé¾èŒ¶ï¼ˆé˜¿é‡Œå±±é”é‚¦ï½œå¤§åŒ… 5gÃ—30åŒ…ï¼‰", origin:"é˜¿é‡Œå±±é”é‚¦", pack:"çœŸç©ºè¢‹ï¼ˆå¤§ï¼‰", price:1140, note:"å¹³å‡æ¯åŒ…èŒ¶åŒ…ç´„ 38 å…ƒ" },
      { type:"tea", item:"15", name:"ç„¦ç³–é¦™æ‰‹æ¡ç´…èŒ¶", origin:"å—æŠ•ç¸£é­šæ± é„‰æ—¥æœˆæ½­", pack:"ä¸€é»äº”å…©è£", price:300, note:"æ—¥æœˆæ½­ç¨æœ‰ç„¦ç³–é¦™æ°£" },
      { type:"tea", item:"16", name:"æ‰‹æ¡çƒé¾èŒ¶ï¼é‡‘è±èŒ¶ï¼ˆå¯æŒ‘é¸ï¼‰", origin:"ä¿¡ç¾©ï¼æ‰æ—æºªï¼ç‰å±±ç¥æœ¨æ‘ï¼ç‰¹å¯Œé‡ï¼æ¸…å¢ƒï¼æ–°ä½³é™½æ¢¨å±±â€¦", pack:"å››å…©è£", price:1000, note:"å¤šç¨®èŒ¶æ¬¾å¯æŒ‘é¸" },
      { type:"tea", item:"16A", name:"æ‰‹æ¡çƒé¾èŒ¶ï¼ˆæ–°ä½³é™½æ¢¨å±±ï½œå¤§åŒ… 5gÃ—30åŒ…ï¼‰", origin:"æ–°ä½³é™½æ¢¨å±±èŒ¶", pack:"çœŸç©ºè¢‹ï¼ˆå¤§ï¼‰", price:1310, note:"å¹³å‡æ¯åŒ…èŒ¶åŒ…ç´„ 43.8 å…ƒ" },
      { type:"tea", item:"17", name:"æ¡‚èŠ±é‡‘è±ï¼ˆé™é‡ï¼‰", origin:"æ¢¨å±±", pack:"å››å…©è£", price:1000, note:"æ­£å¸¸ç™¼é…µï¼ç¦å£½å±±æ¡‚èŠ±è–°é¦™çƒ˜ç„™" },
      { type:"tea", item:"18", name:"æ­£æ˜¥çƒé¾ï¼æ­£å†¬çƒé¾èŒ¶", origin:"æ¢¨å±±", pack:"å››å…©è£", price:1200, note:"æ­£å¸¸ç™¼é…µåé‡ï¼ç„¡çƒ˜ç„™" },
      { type:"tea", item:"18A", name:"æ­£æ˜¥çƒé¾ï¼æ­£å†¬çƒé¾èŒ¶ï¼ˆå¤§åŒ… 5gÃ—30åŒ…ï¼‰", origin:"", pack:"çœŸç©ºè¢‹ï¼ˆå¤§ï¼‰", price:1450, note:"å¹³å‡æ¯åŒ…èŒ¶åŒ…ç´„ 48.4 å…ƒ" },
      { type:"tea", item:"19", name:"èŠ±æœèœœæ¾é¦™æ‰‹æ¡ç´…èŒ¶", origin:"æ¢¨å±±", pack:"äºŒå…©è£ï¼ˆ40gï¼‰", price:300, note:"å¤šå±¤æ¬¡å£æ„Ÿé¦™æ°£" },
      { type:"tea", item:"20", name:"æ­£æ˜¥çƒé¾ï¼æ­£å†¬çƒé¾èŒ¶", origin:"ç‰å±±å¡”å¡”åŠ ï¼å¤§ç¦¹å¶º", pack:"å››å…©è£", price:1400, note:"æ­£å¸¸ç™¼é…µï¼ç„¡çƒ˜ç„™" },
      { type:"tea", item:"20A", name:"æ­£æ˜¥çƒé¾ï¼æ­£å†¬çƒé¾èŒ¶ï¼ˆå¤§åŒ… 5gÃ—30åŒ…ï¼‰", origin:"", pack:"çœŸç©ºè¢‹ï¼ˆå¤§ï¼‰", price:1520, note:"å¹³å‡æ¯åŒ…èŒ¶åŒ…ç´„ 50.8 å…ƒ" },
      { type:"tea", item:"21", name:"æ‰‹æ¡é’å¿ƒçƒé¾ç´…èŒ¶", origin:"å¤§ç¦¹å¶º", pack:"èŒ¶è‘‰æ·¨é‡30g", price:300, note:"" },
      { type:"tea", item:"22", name:"æ­£æ˜¥çƒé¾ï¼æ­£å†¬çƒé¾èŒ¶", origin:"æ‰æ—æºªé¾é³³å³½ï¼ˆå¿˜æ†‚æ£®æ—ï¼‰", pack:"å››å…©è£", price:1600, note:"æ­£å¸¸ç™¼é…µï¼ç„¡çƒ˜ç„™" },
      { type:"tea", item:"22A", name:"æ­£æ˜¥çƒé¾ï¼æ­£å†¬çƒé¾èŒ¶ï¼ˆå¤§åŒ… 5gÃ—30åŒ…ï¼‰", origin:"", pack:"çœŸç©ºè¢‹ï¼ˆå¤§ï¼‰", price:1660, note:"å¹³å‡æ¯åŒ…èŒ¶åŒ…ç´„ 55.4 å…ƒ" },
      { type:"tea", item:"23", name:"é«˜å±±èŒ¶ç‹æ¯”è³½èŒ¶é ­ç­‰çèŒ¶åœ’ç²¾è£½èŒ¶", origin:"", pack:"äºŒå…©è£", price:900, note:"ä¸­é‡ç™¼é…µï¼æ¯”è³½å‹ç²¾ç·»çƒ˜ç„™" },
      { type:"tea", item:"23A", name:"æ­£æ˜¥çƒé¾ï¼æ­£å†¬çƒé¾èŒ¶ï¼ˆå¤§åŒ… 5gÃ—30åŒ…ï¼‰", origin:"", pack:"çœŸç©ºè¢‹ï¼ˆå¤§ï¼‰", price:1660, note:"å¹³å‡æ¯åŒ…èŒ¶åŒ…ç´„ 55.4 å…ƒ" },
      { type:"tea", item:"24", name:"æ­£æ˜¥çƒé¾ï¼æ­£å†¬çƒé¾èŒ¶", origin:"æ¢¨å±±å¤©æ± ", pack:"äºŒå…©è£", price:1000, note:"æ­£å¸¸ç™¼é…µï¼ç„¡çƒ˜ç„™ï¼èŠ±æœé¦™" },
      { type:"tea", item:"24A", name:"æ­£æ˜¥çƒé¾ï¼æ­£å†¬çƒé¾èŒ¶ï¼ˆå¤§åŒ… 5gÃ—30åŒ…ï¼‰", origin:"", pack:"çœŸç©ºè¢‹ï¼ˆå¤§ï¼‰", price:2200, note:"å¹³å‡æ¯åŒ…èŒ¶åŒ…ç´„ 73.4 å…ƒ" },
      { type:"tea", item:"25", name:"æ­£æ˜¥çƒé¾ï¼æ­£å†¬çƒé¾èŒ¶", origin:"ç¦å£½å±±è¯å´—", pack:"äºŒå…©è£", price:1200, note:"æ­£å¸¸ç™¼é…µï¼ç„¡çƒ˜ç„™ï¼é«˜å±±æ°£å¼·" },
      { type:"tea", item:"25A", name:"æ­£æ˜¥çƒé¾ï¼æ­£å†¬çƒé¾èŒ¶ï¼ˆå¤§åŒ… 5gÃ—30åŒ…ï¼‰", origin:"", pack:"çœŸç©ºè¢‹ï¼ˆå¤§ï¼‰", price:2360, note:"å¹³å‡æ¯åŒ…èŒ¶åŒ…ç´„ 78.8 å…ƒ" },
      { type:"tea", item:"26", name:"ç¦å£½å±±æ¡‚èŠ±çƒé¾èŒ¶", origin:"ç¦å£½æ¢¨å±±", pack:"äºŒå…©è£", price:1500, note:"æ­£å¸¸ç™¼é…µï¼ç¦å£½å±±æ¡‚èŠ±è–°é¦™çƒ˜ç„™" },
      { type:"tea", item:"26A", name:"ç¦å£½å±±æ¡‚èŠ±çƒé¾èŒ¶ï¼ˆå¤§åŒ… 5gÃ—30åŒ…ï¼‰", origin:"", pack:"çœŸç©ºè¢‹ï¼ˆå¤§ï¼‰", price:2360, note:"å¹³å‡æ¯åŒ…èŒ¶åŒ…ç´„ 78.8 å…ƒ" },
      { type:"tea", item:"27", name:"é ‚ç´šå¼·èœœé¦™æ±æ–¹ç¾äºº", origin:"ç‰¹æ®ŠèŒ¶åœ’", pack:"èŒ¶è‘‰æ·¨é‡30g", price:1000, note:"æœ¬åº—æœ€é«˜ç­‰ç´šç´…èŒ¶ï¼å¯åè¦†æ²–æ³¡çš†æœ‰èœœé¦™" },

      // 28â€“33 èŒ¶åŒ…
      { type:"tea", item:"28", name:"ç„¡ç·šé ­ç„¡å¤–åŒ…è£¸åŒ…çƒé¾èŒ¶åŒ…", origin:"", pack:"æ•´çµ„50åŒ…ï¼ˆçœŸç©ºè¢‹ï¼‰", price:250, note:"åŠç”Ÿç†Ÿçƒ˜ç„™çƒé¾ç¢èŒ¶ï¼ä¹…æµ¸æ³¡ä¸è‹¦æ¾€" },
      { type:"tea", item:"29", name:"ç„¡ç·šé ­ç„¡å¤–åŒ…è£¸åŒ…èŒ‰è‰èŒ¶åŒ…", origin:"", pack:"æ•´çµ„50åŒ…ï¼ˆçœŸç©ºè¢‹ï¼‰", price:250, note:"äº”åº¦è–°é¦™ï¼å†·æ³¡ç†±æ³¡éƒ½æ¸…é¦™ï¼ä¹…æ³¡ä¸è‹¦æ¾€" },
      { type:"tea", item:"30", name:"ç„¡ç·šé ­ç„¡å¤–åŒ…è£¸åŒ…æ­£å®—å°ç£ç´…èŒ¶èŒ¶åŒ…", origin:"", pack:"æ•´çµ„50åŒ…ï¼ˆçœŸç©ºè¢‹ï¼‰", price:250, note:"å¸¶é¾çœ¼ä¹¾é¦™ï¼ä¹…æ³¡ä¸è‹¦æ¾€" },
      { type:"tea", item:"31", name:"ç„¡ç·šé ­ç„¡å¤–åŒ…è£¸åŒ…æ™®æ´±èŒ¶åŒ…", origin:"", pack:"æ•´çµ„50åŒ…ï¼ˆçœŸç©ºè¢‹ï¼‰", price:350, note:"é†‡åšè€æ³¡ï¼ä¹…æ³¡ä¸è‹¦æ¾€" },
      { type:"tea", item:"32", name:"æœ‰ç·šé ­æœ‰å¤–åŒ…è£é«˜å±±çƒé¾èŒ¶åŒ…", origin:"é«˜å±±ç¢èŒ¶ï¼ˆçƒ˜ç„™å¾Œå†è£½ï¼‰", pack:"ç›’è£30åŒ…", price:600, note:"æ¯åŒ…ç¨ç«‹åŒ…è£ï¼ä¹…æ³¡ä¸è‹¦æ¾€" },
      { type:"tea", item:"33", name:"æœ‰ç·šé ­æœ‰å¤–åŒ…è£å°ç£ç´…èŒ¶åŒ…", origin:"æ—¥æœˆæ½­çƒé¾ç´…èŒ¶ï¼ˆå¸‚å ´ç¨€æœ‰ï¼‰", pack:"ç›’è£30åŒ…", price:600, note:"æ¯åŒ…ç¨ç«‹åŒ…è£ï¼ä¹…æ³¡ä¸è‹¦æ¾€" },

      // 34â€“39 å…¶ä»–
      { type:"other", item:"34", name:"èŒ¶è‘‰ç™½ç“œå­ï¼ˆåˆç„™ç„¡é¹½ï¼‰", origin:"é›²æ—è¥¿èº", pack:"200gï¼ˆçœŸç©ºåŒ…ï¼‰", price:200, note:"å…§æœ‰è„«æ°§ï¼ä¹¾ç‡¥åŠ‘ä¿é®®" },
      { type:"other", item:"35-S", name:"è‡ªå®¶åŸ¹è‚²é«˜å±±é¦™è‡ï¼ˆå°åŒ… 30gï¼‰", origin:"", pack:"30g", price:200, note:"ä¸ä½¿ç”¨äºŒæ°§åŒ–ç¡«è–°è£½ï¼é¦™æ°£è¶³ï¼ç‚’èœç…®æ¹¯çš†å®œ" },
      { type:"other", item:"35-M", name:"è‡ªå®¶åŸ¹è‚²é«˜å±±é¦™è‡ï¼ˆä¸­åŒ… 50gï¼‰", origin:"", pack:"50g", price:300, note:"ä¸ä½¿ç”¨äºŒæ°§åŒ–ç¡«è–°è£½ï¼é¦™æ°£è¶³ï¼ç‚’èœç…®æ¹¯çš†å®œ" },
      { type:"other", item:"35-L", name:"è‡ªå®¶åŸ¹è‚²é«˜å±±é¦™è‡ï¼ˆå¤§åŒ… 150gï¼‰", origin:"", pack:"150g", price:900, note:"ä¸ä½¿ç”¨äºŒæ°§åŒ–ç¡«è–°è£½ï¼é¦™æ°£è¶³ï¼ç‚’èœç…®æ¹¯çš†å®œ" },
      { type:"other", item:"36", name:"è‡ªå®¶æœåœ’æ¡æ”¶ç™¾èŠ±èœœï¼ˆé™é‡ï¼‰", origin:"", pack:"ä¸€ç“¶", price:2000, note:"è‡ªå®¶æœ‰æ©Ÿç„¡è—¥æœåœ’é‡ç”Ÿèœœèœ‚æ”¶é›†ï¼å¸¶èŠ±é¦™" },
      { type:"other", item:"37", name:"100%å°ç£èŒ¶ç±½æ²¹ï¼ˆè‡ªå®¶èŒ¶ç±½å£“æ¦¨ï¼‰", origin:"", pack:"850gï¼ˆå«ç½é‡ï¼‰", price:1200, note:"èµ·ç…™é»é«˜å¯ç‚’èœï¼è­·æ‰‹è­·è†š" },
      { type:"other", item:"38", name:"æ¼¢æ–¹é™³çš®æ¢…é†¬", origin:"", pack:"900g", price:900, note:"é™³çš®ï¼‹æ¢…å±±æå­ï¼‹è‰æœ¬é‡€è£½ï¼å¯æ²–æ³¡æˆ–å…¥èœ" },
      { type:"other", item:"39", name:"100%å°ç£èŒ¶ç±½ç²‰ å¤©ç„¶ç’°ä¿æ¸…æ½”åŠ‘", origin:"", pack:"1kg", price:400, note:"å¤©ç„¶çš‚ç´ ç„¡æ¯’å»æ²¹ä¸å‚·æ‰‹ï¼ä¸å µå¡æ°´ç®¡" },
    ]
  };
</script>

<!-- Cart bar -->
<div class="cartbar">
  <div class="cartinner">
    <div class="cartleft">
      <span class="cartcount" id="cartCount">ğŸ›’ å°šæœªé¸æ“‡å•†å“</span>
      <span class="cartitems" id="cartItems"></span>
    </div>
    <div class="row">
      <button class="btn" id="btnCart">æŸ¥çœ‹ï¼ä¿®æ”¹</button>
      <button class="btn btnPri" id="btnMsg">è©¢å•ï¼ä¸‹å–®</button>
    </div>
  </div>
</div>

<div class="wrap">
  <!-- Hero -->
  <div class="card hero">
    <h1 id="heroTitle"></h1>
    <p class="lead" id="heroText"></p>
    <div class="mini" id="noSample"></div>
  </div>

  <div class="grid">
    <!-- Left -->
    <div class="card">
      <div class="cardHd">
        <p class="title">é–‹å§‹é¸æ“‡</p>
        <p class="sub">æ‰‹æ©Ÿç‰ˆæœƒç›´æ’é¡¯ç¤ºï¼Œé¸å®Œå³æ›´æ–°æ¨è–¦ï¼›ä¹Ÿå¯ç›´æ¥çœ‹å®Œæ•´ç›®éŒ„åŠ å…¥è³¼ç‰©è»Šã€‚</p>
      </div>
      <div class="cardBd" id="quiz"></div>

      <div class="cardBd" style="padding-top:0">
        <details id="catalogDetails">
          <summary>ğŸ“š æŸ¥çœ‹å…¨éƒ¨å•†å“ç›®éŒ„ï¼ˆå¯æœå°‹ï¼ç›´æ¥åŠ å…¥ï¼‰</summary>
          <div class="catalogList">
            <div class="catalogTop">
              <div class="search">
                <input id="searchInput" type="search" placeholder="æœå°‹ï¼šç·¨è™Ÿ / å“å / ç”¢åœ° / åŒ…è£ï¼ˆä¾‹å¦‚ï¼š8Aã€æ¢¨å±±ã€èŒ¶åŒ…ã€å››å…©ï¼‰" />
              </div>
              <div class="row" style="justify-content:flex-end">
                <button class="btn" id="tabAll">å…¨éƒ¨</button>
                <button class="btn" id="tabTea">èŒ¶</button>
                <button class="btn" id="tabOther">ç‰¹è‰²å•†å“</button>
              </div>
            </div>
            <div id="catalog"></div>
          </div>
        </details>
      </div>
    </div>

    <!-- Right -->
    <div class="card">
      <div class="cardHd">
        <p class="title">æ¨è–¦çµæœ</p>
        <p class="sub">é¡¯ç¤ºåº—è™Ÿï¼ˆå¯å°æ‡‰ä½ çš„ç³»çµ±ï¼‰ã€åƒ¹æ ¼èˆ‡åŒ…è£è¦æ ¼ï¼›åŠ å…¥è³¼ç‰©è»Šå¾Œåªé¸æ•¸é‡ã€‚</p>
      </div>
      <div class="cardBd">
        <div class="result" id="results"></div>
        <div class="footnote" id="unitNote"></div>
      </div>
    </div>
  </div>

  <!-- Cart Drawer -->
  <div class="card drawer" id="cartDrawer">
    <div class="cardHd">
      <p class="title">è³¼ç‰©è»Š</p>
      <p class="sub">è¦æ ¼å·²å›ºå®šï¼ˆç…§ç›®éŒ„ï¼‰ï¼Œæ‚¨åªè¦é¸æ•¸é‡ã€‚</p>
    </div>
    <div class="drawerBody" id="cartBody"></div>
  </div>

  <div class="footer-protect-notice">
    ç³»çµ±èˆ‡æ¨è–¦é‚è¼¯ç‚ºæœ¬åº—ä¹‹ç¨å®¶è¨­è¨ˆï¼Œæœªç¶“æˆæ¬Šè«‹å‹¿ç”¨æ–¼å…¶ä»–ç”¨é€”ã€‚<br>
    å•†å“è³‡è¨Šèˆ‡åƒ¹æ ¼ä»¥æœ¬åº—å…¬å‘Šç‚ºæº–ã€‚
  </div>
</div>

<script>
  const $ = (id)=>document.getElementById(id);
  const LS_CART = "xiaowen_cart_v2";
  const LS_ANS  = "xiaowen_answers_v2";

  const state = {
    answers: JSON.parse(localStorage.getItem(LS_ANS) || "{}"),
    cart: JSON.parse(localStorage.getItem(LS_CART) || "[]"),
    catalogTab: "all",
    search: ""
  };

  function save(){
    localStorage.setItem(LS_CART, JSON.stringify(state.cart));
    localStorage.setItem(LS_ANS, JSON.stringify(state.answers));
  }

  function money(n){
    try{ return Number(n).toLocaleString("zh-TW"); }catch(e){ return String(n); }
  }

  function labelOf(key, value){
    const q = CONFIG.questions.find(x=>x.key===key);
    const opt = q?.options?.find(o=>o.value===value);
    if(!opt) return value;
    // ä¸ç”¨ç‰¹æ®Š regexï¼Œé¿å…ç€è¦½å™¨ç›¸å®¹æ€§å•é¡Œ
    return String(opt.label).replace(/\s+/g," ").trim();
  }

  function heroSetup(){
    $("heroTitle").textContent = CONFIG.heroTitle;
    $("heroText").textContent  = CONFIG.heroText;
    $("noSample").textContent  = CONFIG.noSampleNotice;
    $("unitNote").textContent  = CONFIG.unitNote;
  }

  function renderQuiz(){
    const root = $("quiz");
    root.innerHTML = "";

    const cat = state.answers.category;

    CONFIG.questions.forEach((q)=>{
      // âœ… Q1 = other æ™‚ï¼Œè·³é Q2â€“Q5ï¼›Q1=pick ä»ç•¶ã€ŒèŒ¶ã€æ¨è–¦ä½†å¯å°‘é¸
      if(q.key !== "category" && cat === "other") return;

      const box = document.createElement("div");
      box.style.marginBottom = "14px";

      const head = document.createElement("div");
      head.className="row";
      head.style.justifyContent="space-between";

      const qTitle = document.createElement("p");
      qTitle.className="q";
      qTitle.textContent = q.title;

      const chosen = document.createElement("span");
      chosen.className="pill";
      chosen.textContent = state.answers[q.key] ? `å·²é¸ï¼š${labelOf(q.key, state.answers[q.key])}` : "å°šæœªé¸";

      head.appendChild(qTitle);
      head.appendChild(chosen);

      const opts = document.createElement("div");
      opts.className="options";

      q.options.forEach(opt=>{
        const btn = document.createElement("button");
        btn.type="button";
        btn.className="opt";
        if(state.answers[q.key] === opt.value) btn.classList.add("active");
        btn.innerHTML = `<div>${opt.label}</div><small>${opt.note || ""}</small>`;
        btn.onclick = ()=>{
          state.answers[q.key] = opt.value;

          // è‹¥æ”¹äº† Q1ï¼Œé †ä¾¿æ¸…æ‰å¾Œé¢ä¸ç›¸å¹²ç­”æ¡ˆï¼ˆé¿å…æ€ªï¼‰
          if(q.key==="category"){
            if(opt.value==="other"){
              delete state.answers.use;
              delete state.answers.feel;
              delete state.answers.budget;
              delete state.answers.flavor;
            }
          }

          save();
          renderQuiz();
          renderResults();
        };
        opts.appendChild(btn);
      });

      box.appendChild(head);
      box.appendChild(opts);
      root.appendChild(box);
    });

    const actions = document.createElement("div");
    actions.className="row";
    actions.innerHTML = `
      <button class="btn" id="btnReset">æ¸…ç©ºé¸æ“‡</button>
      <button class="btn" id="btnResetCart">æ¸…ç©ºè³¼ç‰©è»Š</button>
    `;
    root.appendChild(actions);

    $("btnReset").onclick = ()=>{
      state.answers = {};
      save();
      renderQuiz();
      renderResults();
    };
    $("btnResetCart").onclick = ()=>{
      state.cart = [];
      save();
      renderCartBar();
      renderCartDrawer();
    };
  }

  // ===== æ¨è–¦é‚è¼¯ï¼ˆå®‰å…¨ã€å¯ç”¨ã€ä¸æœƒæŠŠä¾¿å®œçš„æ¨æˆçè—ï¼‰=====
  function budgetTierByPrice(price){
    // ä¾ã€Œå–®ä½å”®åƒ¹ã€åˆ†ç´šï¼ˆä½  Q4 çš„ç™½è©±å€é–“ï¼‰
    if(price <= 400) return "daily";
    if(price <= 800) return "gift";
    if(price <= 1200) return "flavor";
    return "rare";
  }

  function inferFlavor(p){
    const t = (p.name + " " + (p.note||"")).toLowerCase();
    if(t.includes("çƒ˜ç„™") || t.includes("ç„™")) return "roast";
    if(t.includes("ç´…èŒ¶") || t.includes("èœœ") || t.includes("ç„¦ç³–") || t.includes("æ¡‚èŠ±") || t.includes("æ±æ–¹ç¾äºº") || t.includes("ç³–é¦™")) return "sweet";
    if(t.includes("èŒ‰è‰") || t.includes("é¦™ç‰‡")) return "fresh";
    return "fresh";
  }

  function inferFeel(p){
    const t = (p.name + " " + (p.note||"")).toLowerCase();
    if(t.includes("é‡çƒ˜ç„™") || t.includes("é‡ç™¼é…µ") || t.includes("ç²¾ç·»çƒ˜ç„™") || t.includes("æ™®æ´±") ) return "bold";
    if(t.includes("è¼•") && (t.includes("çƒ˜ç„™") || t.includes("ç™¼é…µ"))) return "balanced";
    if(t.includes("ç„¡çƒ˜ç„™")) return "light";
    return "balanced";
  }

  function matchScore(p){
    const cat = state.answers.category;

    // category åˆ†æµ
    if(cat === "other"){
      if(p.type !== "other") return -999;
    }else{
      // tea æˆ– pickï¼šä¸»æ¨èŒ¶ï¼ˆä½†ç›®éŒ„ä»å¯åŠ å…¶ä»–ï¼‰
      if(p.type !== "tea") return -999;
    }

    const use = state.answers.use || (cat==="pick" ? "unsure" : "");
    const feel = state.answers.feel || (cat==="pick" ? "pick" : "");
    const budget = state.answers.budget || (cat==="pick" ? "" : "");
    const flavor = state.answers.flavor || (cat==="pick" ? "pick" : "");

    let score = 0;

    // ç”¨é€”ï¼šé€äººåå‘è¼ƒé«˜åƒ¹ä½ã€é™é‡ã€é«”é¢ï¼›è‡ªç”¨åè€å–/å¹³åƒ¹
    if(use==="gift"){
      if(p.price >= 600) score += 2;
      if((p.note||"").includes("é™é‡") || (p.name||"").includes("æ¯”è³½")) score += 2;
    }
    if(use==="self"){
      if(p.price <= 800) score += 2;
      if((p.name||"").includes("èŒ¶åŒ…") || (p.note||"").includes("è€æ³¡") || (p.note||"").includes("ä¹…æ³¡")) score += 1;
    }

    // æ¿ƒæ·¡
    const pFeel = inferFeel(p);
    if(feel && feel !== "pick"){
      if(feel === pFeel) score += 3;
    }else{
      score += 1; // ä¸ç¢ºå®šï¼šç¨åŠ åˆ†ï¼Œé¿å…æ‰å‡ºçµæœ
    }

    // é¢¨å‘³
    const pFlavor = inferFlavor(p);
    if(flavor && flavor !== "pick"){
      if(flavor === pFlavor) score += 2;
    }else{
      score += 1;
    }

    // é ç®—ï¼šç”¨ã€Œå”®åƒ¹ã€å°æ‡‰ Q4
    if(budget){
      const tier = budgetTierByPrice(p.price);
      if(tier === budget) score += 3;
    }else{
      score += 1;
    }

    // å¾®èª¿ï¼šèŒ¶åŒ…åœ¨è‡ªç”¨æ™‚åŠ åˆ†
    if(p.name.includes("èŒ¶åŒ…") && use==="self") score += 1;

    return score;
  }

  function pickProducts(){
    const cat = state.answers.category;
    if(!cat) return [];

    if(cat === "other"){
      const others = CONFIG.products.filter(p=>p.type==="other")
        .sort((a,b)=>matchScore(b)-matchScore(a));
      // ä¸»æ¨ 1 + ä¹Ÿé©åˆ 1
      return others.slice(0,2);
    }

    // tea æˆ– pick
    const teas = CONFIG.products.filter(p=>p.type==="tea")
      .sort((a,b)=>matchScore(b)-matchScore(a));
    // ä¸»æ¨ 1 + ä¹Ÿé©åˆ 1
    return teas.slice(0,2);
  }

  function renderResults(){
    const root = $("results");
    root.innerHTML = "";

    const picked = pickProducts();
    if(picked.length === 0){
      root.innerHTML = `<p class="muted">å…ˆå¾å·¦é‚Š Q1 é–‹å§‹é¸æ“‡ï¼ˆæˆ–å±•é–‹ã€Œå…¨éƒ¨å•†å“ç›®éŒ„ã€ç›´æ¥åŠ å…¥ï¼‰ã€‚</p>`;
      return;
    }

    picked.forEach((p, i)=>{
      const card = document.createElement("div");
      card.className="rCard";

      const bd = document.createElement("div");
      bd.className="rBd";

      const rank = (i===0 ? "â­ ä¸»æ¨" : "â—»ï¸ ä¹Ÿå¾ˆé©åˆæ‚¨");

      bd.innerHTML = `
        <div class="row" style="justify-content:space-between;align-items:flex-start">
          <div style="min-width:0">
            <div class="pill">${rank}</div>
            <h3 class="rName">åº—è™Ÿ ${p.item}ï½œ${p.name}</h3>
            <p class="rMeta">ç”¢åœ°ï¼ç­‰ç´šï¼š<b>${p.origin || "å°ç£"}</b></p>
            <p class="rMeta">åŒ…è£ï¼š<b>${p.pack}</b></p>
            <p class="rMeta">åƒ¹æ ¼ï¼š<b>NT$ ${money(p.price)}</b></p>
            ${p.note ? `<p class="rMeta">å‚™è¨»ï¼š${p.note}</p>` : ``}
          </div>
          <button class="btn btnPri">ï¼‹åŠ å…¥è³¼ç‰©è»Š</button>
        </div>
      `;
      bd.querySelector("button").onclick = ()=> addToCart(p);

      card.appendChild(bd);
      root.appendChild(card);
    });
  }

  // ===== Cart =====
  function addToCart(p){
    const existing = state.cart.find(x=>x.item===p.item);
    if(existing) existing.qty += 1;
    else state.cart.push({
      item:p.item, name:p.name, origin:p.origin, pack:p.pack, price:p.price, qty:1, type:p.type
    });
    save();
    renderCartBar();
    renderCartDrawer();
    window.scrollTo({ top: 0, behavior:"smooth" });
  }

  function renderCartBar(){
    const count = state.cart.reduce((s,x)=>s+x.qty,0);
    if(count===0){
      $("cartCount").textContent = "ğŸ›’ å°šæœªé¸æ“‡å•†å“";
      $("cartItems").textContent = "";
    }else{
      $("cartCount").textContent = `ğŸ›’ å·²é¸ ${count} ä»¶`;
      const names = state.cart.map(x=>`${x.name}ï¼ˆ${x.item}ï¼‰Ã—${x.qty}`).join("ã€");
      $("cartItems").textContent = names;
    }
  }

  function renderCartDrawer(){
    const body = $("cartBody");
    body.innerHTML = "";

    if(state.cart.length===0){
      body.innerHTML = `<p class="muted">è³¼ç‰©è»Šç›®å‰æ˜¯ç©ºçš„ã€‚æ‚¨å¯ä»¥å¾æ¨è–¦çµæœæˆ–å®Œæ•´ç›®éŒ„åŠ å…¥ã€‚</p>`;
      return;
    }

    state.cart.forEach((x)=>{
      const div = document.createElement("div");
      div.className="item";
      div.style.marginBottom="10px";
      div.innerHTML = `
        <div class="itemTop">
          <div style="min-width:0">
            <p class="itemName">åº—è™Ÿ ${x.item}ï½œ${x.name}</p>
            <p class="itemMeta">åŒ…è£ï¼š<b>${x.pack}</b> ï½œ åƒ¹æ ¼ï¼š<b>NT$ ${money(x.price)}</b></p>
          </div>
          <div class="qty">
            <button aria-label="minus">ï¼</button>
            <span>${x.qty}</span>
            <button aria-label="plus">ï¼‹</button>
          </div>
        </div>
        <div class="hr"></div>
        <button class="btn danger">ç§»é™¤</button>
      `;
      const [minus, plus] = div.querySelectorAll(".qty button");
      const remove = div.querySelector(".danger");

      minus.onclick = ()=>{
        x.qty = Math.max(1, x.qty-1);
        save(); renderCartBar(); renderCartDrawer();
      };
      plus.onclick = ()=>{
        x.qty += 1;
        save(); renderCartBar(); renderCartDrawer();
      };
      remove.onclick = ()=>{
        state.cart = state.cart.filter(t=>t.item!==x.item);
        save(); renderCartBar(); renderCartDrawer();
      };

      body.appendChild(div);
    });

    const total = state.cart.reduce((s,x)=>s + x.price * x.qty, 0);

    body.insertAdjacentHTML("beforeend", `
      <div class="hr"></div>
      <p class="muted">å°è¨ˆï¼ˆä¸å«é‹ï¼‰ï¼š<b>NT$ ${money(total)}</b></p>
      <div class="row" style="justify-content:flex-end">
        <button class="btn" id="btnContinue">ç¹¼çºŒæŒ‘é¸</button>
        <button class="btn btnPri" id="btnMsg2">è©¢å•ï¼ä¸‹å–®</button>
      </div>
    `);
    $("btnContinue").onclick = ()=>{ $("cartDrawer").classList.remove("open"); window.scrollTo({top:0, behavior:"smooth"}); };
    $("btnMsg2").onclick = ()=> openMessenger();
  }

  function openMessenger(){
    if(!state.cart.length){
      alert("è³¼ç‰©è»Šæ˜¯ç©ºçš„ï¼Œè«‹å…ˆåŠ å…¥å•†å“ã€‚");
      return;
    }

    const lines = [];
    lines.push("ä½ å¥½ï¼Œæˆ‘è¦ä¸‹å–®ï¼š");
    lines.push("");
    state.cart.forEach(x=>{
      lines.push(`ãƒ»åº—è™Ÿ ${x.item}ï½œ${x.name}`);
      lines.push(`  åŒ…è£ï¼š${x.pack}ï½œå–®åƒ¹ NT$ ${money(x.price)}ï½œæ•¸é‡ Ã—${x.qty}`);
    });
    const total = state.cart.reduce((s,x)=>s + x.price * x.qty, 0);
    lines.push("");
    lines.push(`å°è¨ˆï¼ˆä¸å«é‹ï¼‰ï¼šNT$ ${money(total)}`);
    lines.push("è«‹å”åŠ©æˆ‘ç¢ºèªé‹é€èˆ‡ä»˜æ¬¾æ–¹å¼ï¼Œè¬è¬ã€‚");

    const text = lines.join("\n");
    const url = CONFIG.messengerUrl && CONFIG.messengerUrl !== "https://m.me/"
      ? `${CONFIG.messengerUrl}?ref=${encodeURIComponent(text)}`
      : "";

    if(url){
      window.open(url, "_blank");
    }else{
      // æ²’å¡«ç²‰å°ˆç¶²å€å°±è¤‡è£½
      if(navigator.clipboard?.writeText){
        navigator.clipboard.writeText(text);
        alert("æˆ‘å·²æŠŠä¸‹å–®å…§å®¹è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼Œä½ å¯ä»¥ç›´æ¥è²¼åˆ° Messenger/LINEã€‚\n\nï¼ˆè‹¥æœªæˆåŠŸï¼Œè«‹æ‰‹å‹•è¤‡è£½ä¸‹æ–¹æ–‡å­—ï¼‰\n\n" + text);
      }else{
        alert(text);
      }
    }
  }

  function wireUI(){
    $("btnCart").onclick = ()=>{ $("cartDrawer").classList.toggle("open"); renderCartDrawer(); };
    $("btnMsg").onclick = ()=> openMessenger();

    // catalog tabs + search
    $("tabAll").onclick = ()=>{ state.catalogTab="all"; renderCatalog(); };
    $("tabTea").onclick = ()=>{ state.catalogTab="tea"; renderCatalog(); };
    $("tabOther").onclick = ()=>{ state.catalogTab="other"; renderCatalog(); };

    $("searchInput").addEventListener("input", (e)=>{
      state.search = (e.target.value || "").trim();
      renderCatalog();
    });
  }

  function renderCatalog(){
    const root = $("catalog");
    const q = (state.search || "").toLowerCase();
    const tab = state.catalogTab;

    const list = CONFIG.products.filter(p=>{
      if(tab==="tea" && p.type!=="tea") return false;
      if(tab==="other" && p.type!=="other") return false;
      if(!q) return true;

      const hay = `${p.item} ${p.name} ${p.origin||""} ${p.pack||""} ${p.note||""}`.toLowerCase();
      return hay.includes(q);
    });

    root.innerHTML = "";

    if(list.length===0){
      root.innerHTML = `<p class="muted" style="margin-top:10px">æ‰¾ä¸åˆ°ç¬¦åˆçš„å•†å“ï¼Œæ›å€‹é—œéµå­—è©¦è©¦çœ‹ã€‚</p>`;
      return;
    }

    list.forEach(p=>{
      const div = document.createElement("div");
      div.className="cRow";
      div.innerHTML = `
        <div class="cLeft">
          <p class="cName">åº—è™Ÿ ${p.item}ï½œ${p.name}</p>
          <p class="cMeta">ç”¢åœ°ï¼ç­‰ç´šï¼š${p.origin || "å°ç£"}</p>
          <p class="cMeta">åŒ…è£ï¼š${p.pack}</p>
          <p class="cPrice">NT$ ${money(p.price)}</p>
          ${p.note ? `<p class="cMeta">å‚™è¨»ï¼š${p.note}</p>` : ``}
        </div>
        <div>
          <button class="btn btnPri">åŠ å…¥</button>
        </div>
      `;
      div.querySelector("button").onclick = ()=> addToCart(p);
      root.appendChild(div);
    });
  }

  // init
  heroSetup();
  wireUI();
  renderQuiz();
  renderResults();
  renderCartBar();
  renderCartDrawer();
  renderCatalog();
</script>
</body>
</html>
