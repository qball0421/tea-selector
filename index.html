function renderCatalog(){
  const root = $("catalog");
  root.innerHTML = "";

  const list = [...CONFIG.products];

  // 分類：茶（散茶）/ 茶包 / 特色商品
  const teas = list.filter(p=>p.type==="tea");
  const bags = list.filter(p=>p.type==="bag");
  const others = list.filter(p=>p.type==="other");

  // 茶再細分（用名稱關鍵字，夠用又不會燒腦）
  const groupTea = (p)=>{
    const n = p.name || "";
    if(n.includes("紅茶") || n.includes("紅烏龍")) return "紅茶系";
    if(n.includes("東方美人")) return "特殊茶";
    if(n.includes("金萱")) return "金萱";
    if(n.includes("四季春")) return "四季春";
    if(n.includes("烏龍")) return "烏龍";
    if(n.includes("香片") || n.includes("茉莉")) return "花香茶";
    return "其他茶";
  };

  const sortByStoreNo = (a,b)=> String(a.storeNo).localeCompare(String(b.storeNo), "zh-Hant", {numeric:true});

  function section(title, items, subtitle){
    const wrap = document.createElement("div");
    wrap.style.gridColumn = "1 / -1";
    wrap.innerHTML = `
      <div class="hr"></div>
      <div class="row" style="justify-content:space-between;align-items:flex-end">
        <div>
          <p class="title" style="margin:0">${title}</p>
          ${subtitle ? `<p class="sub" style="margin:4px 0 0">${subtitle}</p>` : ``}
        </div>
        <span class="pill">${items.length} 項</span>
      </div>
    `;
    root.appendChild(wrap);
  }

  function cardOf(p){
    const card = document.createElement("div");
    card.className = "pCard";

    const cover = document.createElement("div");
    cover.className = "pCover";
    cover.style.backgroundImage = `url("${productCover(p)}")`;

    const bd = document.createElement("div");
    bd.className = "pBd";

    const v0 = defaultVariant(p);
    let pickedVariantId = v0 ? v0.id : null;

    const meta = ()=>{
      const v = p.variants?.find(x=>x.id===pickedVariantId) || null;
      const pack = v?.pack || p.pack || "";
      const price = productPriceLabel(p, v);
      const note = v?.note ? `｜${v.note}` : "";
      return `
        <p class="pMeta">店號：<b>${p.storeNo}</b> ｜ 產地/等級：<b>${p.origin || "—"}</b></p>
        <p class="pMeta">規格：<b>${pack || "—"}</b> ｜ 價格：<b>${price}</b>${note}</p>
        ${p.note ? `<p class="pMeta">說明：${p.note}</p>` : ""}
      `;
    };

    bd.innerHTML = `
      <h3 class="pName">${p.name}</h3>
      <div class="metaBox">${meta()}</div>
      <div class="variantBox"></div>
      <div class="pActions">
        <button class="btn btnPri">＋加入購物車</button>
      </div>
    `;

    const vBox = bd.querySelector(".variantBox");
    if(p.variants?.length){
      const rerender = (id)=>{
        pickedVariantId = id;
        bd.querySelector(".metaBox").innerHTML = meta();
        renderVariantButtons(vBox, p, pickedVariantId, rerender);
      };
      renderVariantButtons(vBox, p, pickedVariantId, rerender);
    }

    bd.querySelector(".btnPri").onclick = ()=>{
      const v = p.variants?.find(x=>x.id===pickedVariantId) || null;
      addToCart(p, v);
      openCart();
    };

    card.appendChild(cover);
    card.appendChild(bd);
    return card;
  }

  // ====== 茶：依茶系分區 ======
  const teaGroups = {};
  teas.sort(sortByStoreNo).forEach(p=>{
    const g = groupTea(p);
    teaGroups[g] = teaGroups[g] || [];
    teaGroups[g].push(p);
  });

  section("茶（散茶／茶包真空袋）", teas, "依名稱自動分組：四季春 / 金萱 / 烏龍 / 紅茶系 / 花香茶 / 特殊茶");
  Object.keys(teaGroups).forEach(g=>{
    section(g, teaGroups[g]);
    teaGroups[g].forEach(p=> root.appendChild(cardOf(p)));
  });

  // ====== 茶包 ======
  section("茶包（整組／盒裝）", bags, "28–31 固定整組 50 包；32–33 盒裝 30 包");
  bags.sort(sortByStoreNo).forEach(p=> root.appendChild(cardOf(p)));

  // ====== 特色商品 ======
  section("其他特色商品", others, "香菇、花蜜、茶籽油、梅醬、茶籽粉、白瓜子");
  others.sort(sortByStoreNo).forEach(p=> root.appendChild(cardOf(p)));
}
